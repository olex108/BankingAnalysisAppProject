# ПРИЛОЖЕНИЕ ДЛЯ АНАЛИЗА ТРАНЗАКЦИЙ


## Описание проекта:

Проект содержит функции генерации JSON-данных для веб-страниц, формирование Excel-отчетов, а также сервисы

1.  «Веб-страницы». Страница «Главная»
2.  Сервис. "Поиск переводов физическим лицам"
3. Сервис. "Инвесткопилка"
4. Отчет. "Траты по дням недели"


## Установка:

```
git clone https://github.com/olex108/Homework10_1.git
```

## Использование программы:

1. Выгрузите собственный файл из личного кабинета банка в формате .xlsx.
2. Скопируйте файл в папку проекта "data/" 
3. Поменяйте название файла с которым собираетесь работать на operations.xlsx
4. Для предоставления курсов валют, добавьте нужные валюты в список "user_currencies" файла "data/user_settings.json"
5. Для предоставления стоимости акций, добавьте нужные компании в список "user_currencies" файла "data/user_settings.json"
6. Запустите модуль "src/main.py" и следуйте инструкции

## Описание функциональности:

### Модуль views:

#### get_main_page_request 

Функция, принимающую на вход строку с датой и временем и возвращающую JSON-ответ со следующими данными

1. Приветствие в формате: "???", где ??? — «Доброе утро» / «Добрый день» / «Добрый вечер» / «Доброй ночи»
в зависимости от текущего времени, вызывает функцию get_greeting_massage.
2. По каждой карте (вызывает функцию get_cards_spends_list):
- последние 4 цифры карты;
- общая сумма расходов;
- кешбэк (1 рубль на каждые 100 рублей).
3. Топ-5 транзакций по сумме платежа(вызывает функцию в get_top_transaction_list).
4. Курс валют (вызывает функцию).
5. Стоимость акций из S&P500 (вызывает функцию get_stock_prices).

```
Пример структуры JSON-ответа:

{ "greeting": "Добрый день",
  "cards": [
    {
      "last_digits": "5814",
      "total_spent": 1262.00,
      "cashback": 12.62
    },
  ],
  "top_transactions": [
    {
      "date": "21.12.2021",
      "amount": 1198.23,
      "category": "Переводы",
      "description": "Перевод Кредитная карта. ТП 10.2 RUR"
    },
    {
      "date": "20.12.2021",
      "amount": 829.00,
      "category": "Супермаркеты",
      "description": "Лента"
    },
    {
      "date": "20.12.2021",
      "amount": 421.00,
      "category": "Различные товары",
      "description": "Ozon.ru"
    },
    {
      "date": "16.12.2021",
      "amount": -14216.42,
      "category": "ЖКХ",
      "description": "ЖКУ Квартира"
    },
    {
      "date": "16.12.2021",
      "amount": 453.00,
      "category": "Бонусы",
      "description": "Кешбэк за обычные покупки"
    }
  ],
  "currency_rates": [
    {
      "currency": "USD",
      "rate": 73.21
    },
  ],
  "stock_prices": [
    {
      "stock": "AAPL",
      "price": 150.12
    },
    {
      "stock": "AMZN",
      "price": 3173.18
    },
  ]
}
```

### Модуль utils:

#### get_user_settings

Функция для получения данных настроек пользователя из JSON - файла. "/data/user_settings.json"

#### get_transactions_list

Функция для получения списка данных операций пользователя из EXCEL - файла.

#### get_transactions_df

Функция для получения дата фрейма данных операций пользователя из EXCEL - файла.

#### get_transactions_list_for_period

Функция для получения списка данных за определенный период операций пользователя из EXCEL - файла.

#### get_greeting_massage

Функция возвращает строку "приветствие" в зависимости от времени суток

#### get_cards_spends_list

Функция для получения списка трат по каждой карте списка операций.
 
#### get_top_transaction_list

Функция для получения списка ТОП 5 транзакций по данным списка операций.

#### get_currency_rates
    
Функция для получения данных курсов валют.
Принимает данные настроек пользователя и возвращает список курсов валют.
Данные получает из сайта https://www.cbr-xml-daily.ru

#### get_stock_prices

Функция для получения стоимости акций из S&P500.
Принимает данные настроек пользователя и возвращает список стоимости акций API ответом с ресурса Alpha Vantage.
Данные получает url - https://www.alphavantage.co/support/#api-key

### Модуль services:

#### get_transactions_to_persons

Сервис "Поиск переводов физическим лицам"

Функция возвращает JSON со всеми транзакциями, которые относятся к переводам физлицам.
Категория такой транзакции — Переводы, а в описании есть имя и первая буква фамилии с точкой.

#### investment_bank

Сервис. "Инвесткопилка"

Сервис позволяет копить через округление ваших трат.
Можно задать комфортный порог округления: 10, 50 или 100 ₽. Траты будут округляться,
и разница между фактической суммой трат по карте и суммой округления будет попадать на счет «Инвесткопилки».

```
{"amount_saved": float}
```

### Модуль reports:

#### spending_by_weekday

ОТЧЕТ: Траты по дням недели
Функция принимает на вход: дата фрейм с транзакциями, опциональную дату.
Если дата не передана, то берется текущая дата.
Функция возвращает средние траты в каждый из дней недели за последние три месяца (от переданной даты).

```
{
    "Sunday": 0,
    "Monday": 0,
    "Tuesday": 0,
    "Wednesday": 0,
    "Thursday": 0,
    "Friday": 0,
    "Saturday": 0
}
```

## Тестирование функций:

### Модуль utils:

#### get_user_settings

- Тестирование правильности возвращения данных по содержанию файла

#### get_transactions_list_for_period

- Тестирование правильности возвращения данных по содержанию списка данных
- Тестирование правильности возвращения данных при пустом списке данных

#### get_greeting_massage

- Тестирование правильности возвращения данных по заданному времени суток

#### get_cards_spends_list

- Тестирование правильности возвращения данных по содержанию списка данных
- Тестирование правильности возвращения данных при пустом списке данных
 
#### get_top_transaction_list

- Тестирование правильности возвращения данных по содержанию списка данных

#### get_currency_rates
    
- Тестирование правильности возвращения данных по содержанию файла параметров пользователя и ответу сайта
- Тестирование правильности возвращения данных по содержанию файла параметров пользователя при отсутствии ответа сайта

#### get_stock_prices

- Тестирование правильности возвращения данных по содержанию файла параметров пользователя и ответу сайта

### Модуль services:

#### get_transactions_to_persons

- Тестирование правильности возвращения данных по содержанию дата фрейма

#### investment_bank

- Тестирование правильности возвращения данных по содержанию списка транзакций

### Модуль reports:

#### spending_by_weekday

- Тестирование правильности возвращения данных по содержанию дата фрейма
